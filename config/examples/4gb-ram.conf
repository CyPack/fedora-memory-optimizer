# ═══════════════════════════════════════════════════════════════════════════════
# FEDORA MEMORY OPTIMIZER v4.0 - 4GB RAM SYSTEMS
# ═══════════════════════════════════════════════════════════════════════════════
#
# Target: Old laptops, Raspberry Pi 4, low-resource systems
# Typical usage: Lightweight browser + terminal + basic applications
#
# Copy this file into memory-optimizer-v4.sh or pass as environment variable.
#
# ═══════════════════════════════════════════════════════════════════════════════

# RAM Tier: T4
RAM_TIER="T4"

#───────────────────────────────────────────────────────────────────────────────
# ZRAM (Compressed RAM-based swap)
#───────────────────────────────────────────────────────────────────────────────
ZRAM_SIZE="2G"                     # 50% of RAM
ZRAM_ALGORITHM="zstd"              # Best compression
ZRAM_PRIORITY=100                  # High priority

# Effective capacity: ~8GB (with 4x compression)

#───────────────────────────────────────────────────────────────────────────────
# SWAPFILE (NVMe/SSD overflow)
#───────────────────────────────────────────────────────────────────────────────
SWAPFILE_SIZE="8G"                 # RAM × 2
SWAPFILE_PRIORITY=10               # Lower than zram

# Total swap capacity: ~16GB (zram effective + swapfile)

#───────────────────────────────────────────────────────────────────────────────
# USER SESSION LIMITS (NEVER-KILL MODE)
#───────────────────────────────────────────────────────────────────────────────
USER_MEMORY_HIGH="3G"              # Soft limit - throttle starts
# USER_MEMORY_MAX not set!         # No hard limit = No kill

# NEVER-KILL philosophy:
# - System never kills processes
# - Only throttles (slows down)
# - Swaps to zram + swapfile

#───────────────────────────────────────────────────────────────────────────────
# KERNEL PARAMETERS
#───────────────────────────────────────────────────────────────────────────────
VM_SWAPPINESS=180                  # Aggressive zram usage
VM_PAGE_CLUSTER=0                  # Optimal for zram
VM_VFS_CACHE_PRESSURE=50           # Cache protection
VM_MIN_FREE_KBYTES=65536           # 64MB minimum free (for low RAM)

#───────────────────────────────────────────────────────────────────────────────
# SYSTEMD-OOMD (Passive Mode)
#───────────────────────────────────────────────────────────────────────────────
OOMD_SWAP_USED_LIMIT="95%"         # Very high - practically never triggers
OOMD_MEMORY_PRESSURE_LIMIT="90%"   # Very high - practically never triggers
OOMD_PRESSURE_DURATION="60s"       # Long duration

# ═══════════════════════════════════════════════════════════════════════════════
# USAGE
# ═══════════════════════════════════════════════════════════════════════════════
#
# Method 1: Modify values in script
#   nano memory-optimizer-v4.sh
#   # Replace values with the above
#
# Method 2: Environment variable (future version)
#   export ZRAM_SIZE="2G"
#   export SWAPFILE_SIZE="8G"
#   sudo -E ./memory-optimizer-v4.sh
#
# ═══════════════════════════════════════════════════════════════════════════════
