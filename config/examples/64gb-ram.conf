# ═══════════════════════════════════════════════════════════════════════════════
# FEDORA MEMORY OPTIMIZER v4.0 - 64GB+ RAM SYSTEMS
# ═══════════════════════════════════════════════════════════════════════════════
#
# Target: High-end workstations, servers, ML/AI development
# Typical usage: Multiple VMs + containers + heavy workloads
#
# Copy this file into memory-optimizer-v4.sh or pass as environment variable.
#
# ═══════════════════════════════════════════════════════════════════════════════

# RAM Tier: T64
RAM_TIER="T64"

#───────────────────────────────────────────────────────────────────────────────
# ZRAM (Compressed RAM-based swap)
#───────────────────────────────────────────────────────────────────────────────
ZRAM_SIZE="32G"                    # 50% of RAM (capped at 32G for stability)
ZRAM_ALGORITHM="zstd"              # Best compression
ZRAM_PRIORITY=100                  # High priority

# Effective capacity: ~128GB (with 4x compression)

#───────────────────────────────────────────────────────────────────────────────
# SWAPFILE (NVMe/SSD overflow)
#───────────────────────────────────────────────────────────────────────────────
SWAPFILE_SIZE="64G"                # Capped (diminishing returns beyond this)
SWAPFILE_PRIORITY=10               # Lower than zram

# Total swap capacity: ~192GB (zram effective + swapfile)

#───────────────────────────────────────────────────────────────────────────────
# USER SESSION LIMITS (NEVER-KILL MODE)
#───────────────────────────────────────────────────────────────────────────────
USER_MEMORY_HIGH="48G"             # Soft limit - throttle starts
# USER_MEMORY_MAX not set!         # No hard limit = No kill

#───────────────────────────────────────────────────────────────────────────────
# KERNEL PARAMETERS
#───────────────────────────────────────────────────────────────────────────────
VM_SWAPPINESS=180                  # Aggressive zram usage
VM_PAGE_CLUSTER=0                  # Optimal for zram
VM_VFS_CACHE_PRESSURE=50           # Cache protection
VM_MIN_FREE_KBYTES=1048576         # 1GB minimum free

#───────────────────────────────────────────────────────────────────────────────
# SYSTEMD-OOMD (Passive Mode)
#───────────────────────────────────────────────────────────────────────────────
OOMD_SWAP_USED_LIMIT="95%"         # Very high - practically never triggers
OOMD_MEMORY_PRESSURE_LIMIT="90%"   # Very high - practically never triggers
OOMD_PRESSURE_DURATION="60s"       # Long duration

# ═══════════════════════════════════════════════════════════════════════════════
# NOTES FOR HIGH-RAM SYSTEMS
# ═══════════════════════════════════════════════════════════════════════════════
#
# 1. zram size is capped at 32G for stability
#    - Beyond this, compression overhead increases
#    - Diminishing returns past 32GB zram
#
# 2. Swapfile size is capped at 64G
#    - With 64GB+ RAM, you rarely need more
#    - Hibernate may need more (RAM × 1.5)
#
# 3. Consider adjusting VM_SWAPPINESS
#    - 180 is aggressive
#    - For ML/AI workloads, try 100-150
#
# ═══════════════════════════════════════════════════════════════════════════════
